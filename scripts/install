#/bin/sh

# Color definitions
black='\033[0;30m'
red='\033[0;31m'
green='\033[0;32m'
yellow='\033[0;33m'
blue='\033[0;34m'
purple='\033[0;35m'
cyan='\033[0;36m'
white='\033[0;37m'

# Define helpful variables
OH_MY_ZSH_DIR=$HOME/.oh-my-zsh
PLUGIN_DIR=$OH_MY_ZSH_DIR/custom/plugins
THEMES_DIR=$OH_MY_ZSH_DIR/custom/themes
GH_URL=https://github.com

# Log utils
function log_info() { echo "${cyan}$@${white}"; }
function log_success() { echo "${green}$@${white}"; }

# Function to safely link files
function safe_ln() {
    mv $2 $2.old
    ln -s $1 $2
}

#       BREW      #
# --------------- #

# Install dependencies
log_info ">>> BREW: Install dependencies <<<"
brew update
while read p; do
  brew install "$p"
done <~/.dotfiles/requirements/brew-requirements.txt

#       NVIM      #
# --------------- #

# Install `dein`
log_info ">>> NVIM: Install dein <<<"

curl https://raw.githubusercontent.com/Shougo/dein.vim/master/bin/installer.sh \
    > dein_installer.sh \
    2> /dev/null

sh ./dein_installer.sh ~/.dotfiles/dein > /dev/null
rm dein_installer.sh

# Setup ini file
log_info ">>> NVIM: Setup rc file <<<"
mkdir -p ~/.config/nvim
mv ~/.config/nvim/init.vim ~/.config/nvim/init.vim.old &> /dev/null
echo "source ~/.dotfiles/vimrc"  > ~/.config/nvim/init.vim

# Prompt success
log_success ">>> NVIM: Setup success <<<"
log_info "Remember to run dein#install() when running vim for the first time"

#       TMUX      #
# --------------- #

# Link config file
safe_ln ~/.dotfiles/tmux.conf ~/.tmux.conf
log_success ">>> TMUX: Setup success <<<"

#       VIFM      #
# --------------- #

# Create dirs
mkdir -p ~/.config/vifm
mkdir -p ~/.config/vifm/colors

# Setup config file
echo "source ~/.dotfiles/vifmrc.vim"  > ~/.config/vifm/vifmrc
cp ~/..dotfiles/zenburn.vifm ~/.config/vifm/colors/zenburn.vifm

# Success prompt
log_success ">>> VIFM: Setup success <<<"

#       GIT       #
# --------------- #

# Link config file
safe_ln ~/.dotfiles/git-template/gitconfig.global ~/.gitconfig

#       ZSH       #
# --------------- #

# Install Oh My Zsh
log_info ">>> ZSH: Install Oh-my-zsh <<<"
wget $GH_URL/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | zsh
safe_ln ~/.dotfiles/zshrc ~/.zshrc

# Install extra plugins
log_info ">>> ZSH: Install Oh-my-zsh plugins <<<"
while read plugin; do
  gh_path=$(echo $plugin | cut -d ' ' -f 1)
  dst_path=$(echo $plugin | cut -d ' ' -f 2)
  git clone --depth=1 $GH_URL/$gh_path $PLUGIN_DIR/$dst_path
done <~/.dotfiles/requirements/zsh-plugins.txt

# Install PowerLevel10K
log_info ">>> ZSH: Install Oh-my-zsh PowerLevel10K <<<"
git clone --depth=1 \
    $GH_URL/romkatv/powerlevel10k.git \
    $THEMES_DIR/powerlevel10k

# Set Zsh as default shell
log_info ">>> ZSH: Setup default shell <<<"
chsh -s $(which zsh)

# Success prompt!
log_success ">>> ZSH: Setup success <<<"

